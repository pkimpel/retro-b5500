<!DOCTYPE html>
<head>
<title>B5500 Emulator Operator Console</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="Author" content="Nigel Williams & Paul Kimpel">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<meta http-equiv="Content-Style-Type" content="text/css">
<link id=defaultStyleSheet rel=stylesheet type="text/css" href="B5500Console.css">

<script src="./B5500DummyUnit.js"></script>
<script src="./B5500SPOUnit.js"></script>
<script src="./B5500DiskUnit.js"></script>

<script src="../emulator/B5500SystemConfiguration.js"></script>
<script src="../emulator/B5500CentralControl.js"></script>
<script src="../emulator/B5500Processor.js"></script>
<script src="../emulator/B5500IOUnit.js"></script>

<script>
window.onload = function() {
    var aControl;
    var aNormal;
    var bControl;
    var bNormal;
    var boundBlinkenlicht;
    var cc = new B5500CentralControl();
    var timer;
    var timerInterval = 50;             // milliseconds

    function $$(id) {
        return document.getElementById(id)
    }

    function bindMethod(f, context) {
        return function() {f.apply(context, arguments)};
    }

    function PowerOnBtn_Click(ev) {
        $$("PowerOnBtn").className = "whiteButton whiteLit";
        $$("AControlBtn").className = "yellowButton yellowLit";
        cc.powerOn();
        $$("LoadBtn").disabled = false;
        return true;
    }

    function PowerOffBtn_Click(ev) {
        $$("PowerOnBtn").className = "whiteButton";
        $$("ANormalBtn").className = "yellowButton";
        $$("AControlBtn").className = "yellowButton";
        $$("BNormalBtn").className = "yellowButton";
        cc.powerOff();
        $$("HaltBtn").disabled = true;
        $$("LoadBtn").disabled = true;
        if (timer) {
            clearTimeout(timer);
            timer = null;
        }
        return true;
    }

    function HaltBtn_Click(ev) {
        cc.halt();
        $$("HaltBtn").disabled = true;
        $$("LoadBtn").disabled = false;
        if (timer) {
            clearTimeout(timer);
            timer = null;
        }
    }

    function LoadBtn_Click(ev) {
        cc.load();
        $$("HaltBtn").disabled = false;
        $$("LoadBtn").disabled = true;
        boundBlinkenlicht();
    }

    function dasBlinkenlicht() {
        var pa = cc.PA;
        var pb = cc.PB;

        if (pa) {
            if (!pa.busy) {
                aControl.className = "yellowButton";
                aNormal.className = "yellowButton";
            } else if (pa.NCSF) {
                aControl.className = "yellowButton";
                aNormal.className = "yellowButton yellowLit";
            } else {
                aNormal.className = "yellowButton";
                if (pa === cc.P1) {
                    aControl.className = "yellowButton yellowLit";
                }
            }
        }
        if (pb) {
            if (!pb.busy) {
                bControl.className = "yellowButton";
                bNormal.className = "yellowButton";
            } else if (pb.NCSF) {
                bControl.className = "yellowButton";
                bNormal.className = "yellowButton yellowLit";
            } else {
                bNormal.className = "yellowButton";
                if (pb === cc.P1) {
                    bControl.className = "yellowButton yellowLit";
                }
            }
        }

        timer = setTimeout(boundBlinkenlicht, timerInterval);
    }

    /***** window.onload() outer block *****/

    $$("PowerOnBtn").addEventListener("click", PowerOnBtn_Click);
    $$("PowerOffBtn").addEventListener("click", PowerOffBtn_Click);
    $$("HaltBtn").addEventListener("click", HaltBtn_Click);
    $$("LoadBtn").addEventListener("click", LoadBtn_Click);

    aControl = $$("AControlBtn");
    aNormal  = $$("ANormalBtn");
    bControl = $$("BControlBtn");
    bNormal  = $$("BNormalBtn");
    boundBlinkenlicht = bindMethod(dasBlinkenlicht, this);
};
</script>
</head>

<body>

<div id=consoleDiv>
    <button id=HaltBtn class=blackButton DISABLED>HALT</button>

    <button id=NotReadyBtn class=yellowButton>NOT READY</button>
    <button id=LoadSelectBtn class=blackButton>LOAD SELECT</button>
    <button id=LoadBtn class=blackButton DISABLED>LOAD</button>

    <button id=MemoryCheckBtn class=yellowButton>MEMORY CHECK</button>
    <button id=ANormalBtn class=yellowButton>A NORMAL</button>
    <button id=AControlBtn class=yellowButton>A CONTROL</button>
    <button id=BNormalBtn class=yellowButton>B NORMAL</button>
    <button id=BControlBtn class=yellowButton>B CONTROL</button>

    <button id=PowerOnBtn class=whiteButton>POWER<br>ON</button>
    <button id=PowerOffBtn class=blackButton>POWER OFF</button>

    <div id=BurroughsLogo>
        <img id=BurroughsLogoImage src="Burroughs-Logo-Neg.jpg">
    </div>
    <div id=B5500Logo> B 5500 </div>
</div>

</body>
</html>